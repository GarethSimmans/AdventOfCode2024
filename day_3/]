#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>


int check(char buffer[]){
    int first = 0;
    int second = 0;
    char first_buffer[3] = {0};
    char second_buffer[3] = {0};
    int count = 0;

    printf("Enterd Check\n");

    for (int i = 0; i< 99999; i++){
        printf("%c", buffer[i]);
        if (buffer[i] == '0')
            break;
    }


    printf("\nSearching\n");
    char *ptr = strstr(buffer, "mul(");
    printf("Start value: %c\n", ptr[0]);
    ptr[0] = 'W';
    for (int i = 0; i < 4; i++){
        count++;
        if (ptr[4+i] == ','){
            printf("Found ,\n");
            first = atoi(first_buffer);
            if (first != 0 && first < 1000)
                break;
            else{
                return 0;
            }
        }
        if (isdigit(ptr[4+i])){
            printf("Found Digit\n");
            first_buffer[i] = ptr[4+i];
        }
        else{
            return 0;
        }
    }

    printf("Checking second number\n");
    printf("Count: %d\n", count);
    for (int i = 0; i < 4; i++){
        if (ptr[4+count+i] == ')'){
            printf("Found }\n");
            second = atoi(second_buffer);
            if (second != 0 && first < 1000){
                ptr[0] = 0;
                return first * second;
            }
            else{
                return 0;
            }
        }
        if (isdigit(ptr[4+count+i])){
            printf("Found Digit\n");
            second_buffer[i] = ptr[4+count+i];
        }
        else{
            return 0;
        }
}

int main(){
    FILE *fp = fopen("input.txt","r");
    char buffer[1000] = {0};
    int index = 0;
    unsigned long total = 0;

    while(1){
        char ch = fgetc(fp);
        if (ch == EOF)
            break;
        if (ch == '\n'){
            while (strstr(buffer, "mul(") != NULL)
                total += check(buffer);

            memset(buffer, 0, 1000);
            index = 0;
        }
        else{
            buffer[index] = ch;
            index++;
        }
    }
    printf("Total: %lu\n", total);
}
